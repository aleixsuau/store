<div class="main_container">
  <div class="table_container">
    <mat-card>
      <mat-card-header fxLayoutAlign="end center">
        <button mat-raised-button
                (click)="openClientFormDialog()"
                fxFlex="0 0 auto"
                color="primary">
          <mat-icon>add_circle_outline</mat-icon>
          Add Client
        </button>
      </mat-card-header>

      <mat-card-content>
        <mat-table [dataSource]="dataSource"
              [trackBy]="trackBy"
              matSort
              #table
              @fade>
          <mat-header-row class="table-header"
                          *matHeaderRowDef="columns"
                          color="primary"
                          @fade>
          </mat-header-row>

          <mat-row *matRowDef="let item; columns: columns; let index = index"
                  [ngClass]="{'highlight': index%2 == 1}"
                  (click)="openClientFormDialog(item);">
          </mat-row>

          <ng-container matColumnDef="PhotoUrl">
            <mat-header-cell *matHeaderCellDef mat-sort-header></mat-header-cell>
            <mat-cell *matCellDef="let item">
              <div class="profile_image"
                  [ngStyle]="{ 'background-image': 'url(' + (item.PhotoUrl || '/assets/images/user_profile_icon.svg') + ')',
                            'background-size': 'cover'}">
              </div>
            </mat-cell>
          </ng-container>

          <ng-container matColumnDef="FirstName">
            <mat-header-cell *matHeaderCellDef mat-sort-header>FIRST NAME</mat-header-cell>
            <mat-cell *matCellDef="let item">{{ item.FirstName }}</mat-cell>
          </ng-container>

          <ng-container matColumnDef="LastName">
            <mat-header-cell *matHeaderCellDef mat-sort-header>LAST NAME</mat-header-cell>
            <mat-cell *matCellDef="let item">{{ item.LastName }}</mat-cell>
          </ng-container>
        </mat-table>

        <div class="table-message"
              *ngIf="!clients?.length">
          {{ 'Sorry, no results' }}
        </div>

        <div class="table-footer"
            fxLayout="row"
            fxLayoutAlign="end end">
          <mat-paginator [pageSize]="paginatorPageSize"
                         [pageSizeOptions]="paginatorPageSizeOptions"
                         [length]="paginatorLength"
                         [disabled]="paginatorDisabled"
                         (page)="paginatorChange($event);"
                         showFirstLastButtons="true">
          </mat-paginator>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div>



<!-- CLIENT FORM DIALOG TEMPLATE (OPENED ON THE DIALOG) -->
<ng-template #clientTemplate>
  <h4 mat-dialog-title>
    {{
      clientBeingEdited ?
        'EDITING CLIENT: (' + clientBeingEdited.FirstName + ' ' + clientBeingEdited.LastName + ')':
        'ADD CLIENT'
    }}
  </h4>

  <mat-dialog-content>
    <form [formGroup]="clientForm"
          novalidate
          autocomplete="false"
          fxLayout="row wrap"
          fxLayoutAlign="center center">
      <mat-form-field fxFlex="1 1 100%">
        <input type="text"
                placeholder="FirstName"
                matInput
                formControlName="FirstName">

        <mat-error *ngIf="clientForm.get('FirstName').touched && clientForm.get('FirstName').invalid">
          Please insert your FirstName
        </mat-error>
      </mat-form-field>

      <mat-form-field fxFlex="1 1 100%">
        <input type="text"
                placeholder="LastName"
                matInput
                formControlName="LastName">

        <mat-error *ngIf="clientForm.get('LastName').touched && clientForm.get('LastName').invalid">
          Please insert your LastName
        </mat-error>
      </mat-form-field>

      <div fxFlex="1 1 100%"
           class="row">
        <mat-radio-group formControlName="Gender"
                         fxLayoutAlign="start center">
          <mat-radio-button value="Male"
                            fxFlex="0 0 8rem">
            Male
          </mat-radio-button>
          <mat-radio-button value="Female"
                            fxFlex="0 0 8rem">
            Female
          </mat-radio-button>
        </mat-radio-group>
      </div>

      <mat-form-field fxFlex="1 1 100%">
        <input matInput
                [matDatepicker]="picker"
                formControlName="BirthDate"
                placeholder="Pick a date">
        <mat-datepicker-toggle matPrefix [for]="picker"></mat-datepicker-toggle>
        <mat-datepicker #picker></mat-datepicker>
      </mat-form-field>

      <mat-form-field fxFlex="1 1 100%">
        <input type="text"
                placeholder="Email"
                matInput
                formControlName="Email">

        <mat-error *ngIf="clientForm.get('Email').touched && clientForm.get('Email').invalid">
          Please insert a correct email :)
        </mat-error>
      </mat-form-field>

      <mat-form-field fxFlex="1 1 100%">
        <input type="number"
                placeholder="MobilePhone"
                matInput
                formControlName="MobilePhone">

        <mat-error *ngIf="clientForm.get('MobilePhone').touched && clientForm.get('MobilePhone').invalid">
          Please insert your MobilePhone
        </mat-error>
      </mat-form-field>

      <mat-form-field fxFlex="1 1 100%">
        <input type="text"
                placeholder="AddressLine1"
                matInput
                formControlName="AddressLine1">

        <mat-error *ngIf="clientForm.get('AddressLine1').touched && clientForm.get('AddressLine1').invalid">
          Please insert your AddressLine1
        </mat-error>
      </mat-form-field>

      <mat-form-field fxFlex="1 1 100%">
        <input type="text"
                placeholder="AddressLine2"
                matInput
                formControlName="AddressLine2">

        <mat-error *ngIf="clientForm.get('AddressLine2').touched && clientForm.get('AddressLine2').invalid">
          Please insert your AddressLine2
        </mat-error>
      </mat-form-field>

      <mat-form-field fxFlex="1 1 100%">
        <input type="text"
                placeholder="City"
                matInput
                formControlName="City">

        <mat-error *ngIf="clientForm.get('City').touched && clientForm.get('City').invalid">
          Please insert your City
        </mat-error>
      </mat-form-field>

      <mat-form-field fxFlex="1 1 100%">
        <input type="text"
                placeholder="PostalCode"
                matInput
                formControlName="PostalCode">

        <mat-error *ngIf="clientForm.get('PostalCode').touched && clientForm.get('PostalCode').invalid">
          Please insert your Postal Code
        </mat-error>
      </mat-form-field>

      <mat-form-field fxFlex="1 1 100%">
        <input type="text"
                placeholder="Country"
                matInput
                formControlName="Country">

        <mat-error *ngIf="clientForm.get('Country').touched && clientForm.get('Country').invalid">
          Please insert your Country
        </mat-error>
      </mat-form-field>

      <div fxFlex="1 1 100%"
           fxLayoutAlign="start center"
           class="row">
        <mat-checkbox formControlName="IsProspect">
          Is Prospect
        </mat-checkbox>
      </div>

      <div fxFlex="1 1 100%"
           class="row">
        <mat-radio-group formControlName="SendScheduleEmails"
                         fxLayoutAlign="start center">
          <mat-radio-button [value]="true"
                             fxFlex="0 0 8rem">
            Yes
          </mat-radio-button>
          <mat-radio-button [value]="false"
                            fxFlex="0 0 8rem">
            No
          </mat-radio-button>
        </mat-radio-group>
      </div>

      <div fxFlex="1 1 100%"
           class="row">
        <mat-radio-group formControlName="SendAccountEmails"
                         fxLayoutAlign="start center">
          <mat-radio-button [value]="true"
                             fxFlex="0 0 8rem">
            Yes
          </mat-radio-button>
          <mat-radio-button [value]="false"
                            fxFlex="0 0 8rem">
            No
          </mat-radio-button>
        </mat-radio-group>
      </div>
    </form>
  </mat-dialog-content>

  <mat-dialog-actions>
    <button mat-raised-button
            [mat-dialog-close]="clientForm.value"
            [disabled]="clientForm.invalid"
            color="primary">
      <mat-icon>save</mat-icon>
      SAVE
    </button>
    <button mat-raised-button
            mat-dialog-close>
      <mat-icon>close</mat-icon>
      CLOSE
    </button>
  </mat-dialog-actions>
</ng-template>

